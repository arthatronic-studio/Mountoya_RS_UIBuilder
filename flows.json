[
    {
        "id": "aa90945933194d18",
        "type": "tab",
        "label": "Flow 3",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c5d94992ba60fe46",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a4b070f17af03980",
        "type": "exec",
        "z": "aa90945933194d18",
        "command": "sudo rm -rf /tmp/",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1660,
        "y": 700,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "0966792429c23b01",
        "type": "debug",
        "z": "aa90945933194d18",
        "name": "Out Waterflow",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1180,
        "y": 440,
        "wires": []
    },
    {
        "id": "2f540420e1765090",
        "type": "function",
        "z": "aa90945933194d18",
        "name": "waterflow_Function v2",
        "func": "\n\nlet pulseCount = context.get('pulseCount') || 0;\nlet totalLiters = context.get('totalLiters') || 0;\nlet volumeliters = flow.get('volumeliters') || 0;\n// let volumeliters = msg.payload.nilaiWaterflow || 0;\nlet last_volumeliters = 0;\nconst calibrationFactor = 1; // Ganti dengan faktor kalibrasi sensor Anda\n\n// Menghitung aliran dan total liter setiap detik\nif (msg.payload === 1) { // Sensor mengirimkan pulsa (misalnya, 1) setiap kali terjadi\n    pulseCount++;\n}\n\nlet sendPulse = pulseCount;\n\nconst duration = 1.0; // durasi dalam detik\nlet flowRate = (pulseCount / calibrationFactor); // aliran dalam liter per detik\nif (msg.payload.status === 'send') {\n    // totalLiters = msg.payload.nilaiWaterflow;\n    volumeliters = msg.payload.nilaiWaterflow;\n    // totalLiters = volumeliters;\n    last_volumeliters = volumeliters;\n}\nelse {\n    totalLiters += flowRate * duration; // hitung total liter yang sudah mengalir\n    // volumeliters += totalLiters;\n    // volumeliters = volumeliters * 6;\n    volumeliters += 6.647 * pulseCount + 9.328;\n    // volumeliters += 2 * sendPulse;\n    last_volumeliters = volumeliters;\n}\n\n\npulseCount = 0; // reset pulse count\n\n// Simpan nilai di context\ncontext.set('pulseCount', pulseCount);\ncontext.set('totalLiters', totalLiters);\nflow.set('volumeliters', volumeliters);\n\nmsg.payload = {\n    flowRate: flowRate.toFixed(2),\n    totalLiters: totalLiters.toFixed(2),\n    volumeliters: parseInt(flow.get(\"volumeliters\"))\n    // volumeliters: sendPulse\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "a6a0bd6b7f11761d",
        "type": "inject",
        "z": "aa90945933194d18",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "5",
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 710,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "1600d7216e1a5921",
        "type": "inject",
        "z": "aa90945933194d18",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 1470,
        "y": 700,
        "wires": [
            [
                "a4b070f17af03980"
            ]
        ]
    }
]